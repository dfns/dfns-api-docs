# CompleteUserRegistration

`POST /auth/registration`

Completes the registration process.

### Required Permissions <a href="#scopes" id="scopes"></a>

`N/A`

### Parameters <a href="#parameters.1" id="parameters.1"></a>

### Headers  <a href="#request-body" id="request-body"></a>

| Name                | Required | Description                                                                                                                                                                                                                                                                    |
| ------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| X-DFNS-NONCE        | Required | <p>Random value used to prevent replay attacks. Format is base64url encoded JSON string with the following fields: <br>uuid: &#x3C;random value> <br>datetime: &#x3C;The current time of the request in ISO String format, used to expire requests after a period of time></p> |
| X-DFNS-APPID        | Required | ID of the application that was created in the Dfns dashboard                                                                                                                                                                                                                   |
| X-DFNS-APPSECRET    | Optional | Secret associated with the application. Required for server-side application configurations.                                                                                                                                                                                   |
| X-DFNS-APISIGNATURE | Optional | Signature for the API request. Required for server-side application configurations.                                                                                                                                                                                            |
| Authorization       | Required | `temporaryAuthenticationToken` returned from the [InitRegistration](initRegistration) call in Bearer format.                                                                                                                                                 |

### Request body <a href="#request-body" id="request-body"></a>

| Request body fields   | Required/Optional | Description                                                                                                                                                        | Type   |
| --------------------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------ |
| `kind`                | Required          | The kind of credential response the user has provided                                                                                                              | String |
| `credentialInfo`      | Required          | A [KeyCredentialAssertion](#key-credential-assertion) object when `kind` is `Key` or a[Fido2CredentialAssertion](#fido2-credential-assertion) object when `kind` is `FIDO2` or a [PasswordCredentials](#password-creds) object when `kind` is `Password` | String |

#### KeyCredentialAssertion <a href="#key-credential-assertion" id="key-credential-assertion"></a>

| Fields              | Required/Optional | Description                                                                                                            | Type   |
| ------------------- | ----------------- | ---------------------------------------------------------------------------------------------------------------------- | ------ |
| `clientData`        | Required          | The base64url encoded [KeyClientData](#key-client-data) JSON string object that was signed with the user's private key | String |
| `signature`         | Optional          | The base64url encoded signature generated by signing the clientData JSON string object                                 | String |

#### KeyClientData <a href="#key-client-data" id="key-client-data"></a>

| Fields              | Required/Optional | Description                                                                                                                                                                                         | Type    |
| ------------------- | ----------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- |
| `type`              | Required          | A string identifying the kind of client data this object represents. For registration, this must be set to `key.create`                                                                                       | String  |
| `challenge`         | Required          | The challenge returned by the [InitRegistration](initRegistration) call                                                                                                                                           | String  |
| `origin`            | Required          | The origin in which the request was signed. This should match the origin you configured for your Dfns Application. For example, Dfns Dashboard logins would set this to `https://dashboard.dfns.io` | String  |
| `crossOrigin`       | Required          | A flag indicating if the request was signed for a cross-origin request                                                                                                                              | Boolean |

#### Fido2CredentialAssertion <a href="#fido2-credential-assertion" id="fido2-credential-assertion"></a>

| Fields              | Required/Optional | Description                                                                            | Type   |
| ------------------- | ----------------- | -------------------------------------------------------------------------------------- | ------ |
| `credId`            | Required          | The base64url encoded id of the credential returned by the user's WebAuthn client      | String |
| `clientData`        | Required          | The base64url encoded client data object returned by the user's WebAuthn client        | String |
| `attestationData`   | Optional          | The base64url encoded attestation data object returned by the user's WebAuthn client   | String |


##### Typescript example using a browser's builtin WebAuthn client to request user registration and generate the CompleteRegistration RequestBody

```typescript
const credential: PublicKeyCredential = await navigator.credentials.create({
  publicKey: {
    challenge: Buffer.from(authOptions.challenge),
    rp: {
      id: authOptions.rp.id,
      name: authOptions.rp.name
    },
    user: {
      id: Buffer.from(authOptions.user.id),
      name: authOptions.user.name,
      displayName: authOptions.user.displayName
    },
    pubKeyCredParams: authOptions.pubKeyCredParams,
    timeout: 60000,
    excludeCredentials: [],
    authenticatorSelection: {
      requireResidentKey: authOptions.authenticatorSelection.requireResidentKey,
      userVerification: authOptions.authenticatorSelection.userVerification as UserVerificationRequirement
    },
    attestation: authOptions.attestation,
  }
}) as PublicKeyCredential

const response = credential.response as AuthenticatorAttestationResponse
const completeRegistrationRequestBody = {
  credentialType: CredentialType.Fido2,
  credentialInfo: {
    attestationData: arrayBufferToBase64UrlString(response.attestationObject),
    credId: credential.id,
    clientData: arrayBufferToBase64UrlString(response.clientDataJSON),
  },
}
```

### Request example <a href="#request-example.1" id="request-example.1"></a>

#### Sample request <a href="#sample-request" id="sample-request"></a>

```bash
currentTime=$( date -u +"%Y-%m-%dT%H:%M:%SZ" )
nonce=$( echo "{\"datetime\":\"$currentTime\",\"nonce\":\"$(uuidgen)\"}" | base64 | tr '/+' '_-' | tr -d '=' )
curl -X POST "/auth/registration" \
-H "Content-Type: application/json" \
-H "X-DFNS-NONCE: $nonce" \
-H "X-DFNS-APPID: 312CE25E-A112-4D45-9965-6175E7C568DD" \
-H "Authorization: Bearer e3Vd12...9bW3a10" \
-d '{
  "kind": "FIDO2",
  "credentialInfo": {
    "credId": "dV9U2F...DO3dTlr",
    "clientData": "eyJ0eXBlIjoid2ViY...OfeSY",
    "attestationData": "ZTVmM2...WVlMmE0"
  }
}'
```

### Response <a href="#response" id="response"></a>

* `credential` is an object containing the following fields
  * `uuid` is a globally unique ID that identifies the user's credential in the Dfns APIs
  * `kind` is the type of credential the user registered
  * `name` is the name the user provided for this credential
* `user` is an object containing the following fields
  * `id` is the globally unique ID that identifies the user in the Dfns APIs
  * `username` is the registered user's email address
  * `orgId` is the globally unique ID of the org in which the user was registered

#### Response example <a href="#response-example" id="response-example"></a>

```json
{
    "credential": {
        "uuid": "9db396af-47a8-4466-ae89-6ef47626b361",
        "type": "FIDO2",
        "name": ""
    },
    "user": {
        "id": "1eb4abc9-11ad-46fa-b591-a7f094df6f07",
        "username": "bob@example.com",
        "orgId": "82003306-583d-46e0-adfc-3d144b8971fd"
    }
}
```

### Notes <a href="#notes" id="notes"></a>

